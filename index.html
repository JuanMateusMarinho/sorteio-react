<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>.::Sorteios::.</title>
    <link rel="stylesheet" href="/global.css">
  </head>
  <body>
    <header>
      <h1>..::SORTEIOS::..</h1>
    </header>
    <section class="raffle-section">
      <p1>Sorteie usu√°rios da tabela abaixo.</p1>
      <button class="raffle-button">Sorteie um Usu√°rio</button>
    </section>
    <section class="create-user-section">
       <p1 class="text-green">Ou adicione um novo:</p1>
      <nav>
        <button class="create-user-button"><a href="src/novouser.html">Adicionar Novos Usu√°rios</a></button>
      </nav>
    </section> 
    <section>
      <table>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>Op√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          <!-- Linhas de usu√°rios ser√£o inseridas aqui -->
        </tbody>
      </table>
    </section>

    <!-- Modal de Confirma√ß√£o de Dele√ß√£o -->
    <div id="deleteConfirmModal" class="modal">
      <div class="modal-content">
        <span class="close-confirm">&times;</span>
        <p>Deseja deletar o usu√°rio?</p>
        <button id="confirmDeleteBtn" class="action-button delete">Ok</button>
        <button id="cancelDeleteBtn" class="action-button">Cancelar</button>
      </div>
    </div>

      <!-- Modal de Confirma√ß√£o de Altera√ß√£o -->
      <div id="editConfirmModal" class="modal">
        <div class="modal-content">
          <span class="close-edit-confirm">&times;</span>
          <p>Deseja alterar o usu√°rio?</p>
          <button id="confirmEditBtn" class="action-button edit">Ok</button>
          <button id="cancelEditBtn" class="action-button">Cancelar</button>
        </div>
      </div>

    <!-- Modal do Vencedor do Sorteio -->
    <div id="raffleWinnerModal" class="modal">
      <div class="modal-content">
        <span class="close-raffle-winner">&times;</span>
        <h2 class="winner-title">üéâ Parab√©ns! üéâ</h2>
        <p>O usu√°rio sorteado foi:</p>
        <p id="winnerName"></p>
        <p id="winnerEmail"></p>
        <button id="closeRaffleModalBtn" class="action-button">Fechar</button>
      </div>
    </div>

    <footer>
      <p>Admin Client &copy; 2025</p>
    </footer>
    <div id="root"></div>
    <!-- <script type="module" src="/src/main.jsx"></script> -->
    <script>
      // Fun√ß√£o para buscar usu√°rios e preencher a tabela
      async function fetchAndDisplayUsers() {
        const tbody = document.querySelector("table tbody");
        tbody.innerHTML = ""; // Limpa a tabela antes de preencher

        // Dados de teste (mock) para exibir na tabela
        const testUsers = [
          { name: "Usu√°rio de Teste", email: "teste@exemplo.com" },
        ];

        // Cria uma linha na tabela para cada usu√°rio de teste
          testUsers.forEach(user => {
            const tr = document.createElement('tr');
            // Nome
            const tdName = document.createElement('td');
            tdName.className = 'user-name';
            tdName.textContent = user.name;
            tr.appendChild(tdName);

            // Email
            const tdEmail = document.createElement('td');
            tdEmail.className = 'user-email';
            tdEmail.textContent = user.email;
            tr.appendChild(tdEmail);

            // Bot√£o Alterar

            // C√©lula de a√ß√µes: bot√µes um em cima do outro
            const tdActions = document.createElement('td');
            tdActions.className = 'action-cell';
            tdActions.style.display = 'flex';
            tdActions.style.flexDirection = 'column';
            tdActions.style.gap = '8px';

            const editBtn = document.createElement('button');
            editBtn.textContent = 'Alterar';
            editBtn.className = 'action-button edit';
            tdActions.appendChild(editBtn);

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Deletar';
            deleteBtn.className = 'action-button delete';
            tdActions.appendChild(deleteBtn);

            tr.appendChild(tdActions);

            tbody.appendChild(tr);
        });
      }

      // Executa a fun√ß√£o quando o conte√∫do da p√°gina for carregado
      document.addEventListener('DOMContentLoaded', fetchAndDisplayUsers);

      // L√≥gica do Modal de Confirma√ß√£o de Dele√ß√£o
      const deleteModal = document.getElementById('deleteConfirmModal');
      const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
      const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
      const closeConfirmSpan = document.querySelector('.close-confirm');
      let rowToDelete = null;

      document.querySelector('table tbody').addEventListener('click', function(event) {
        if (event.target.classList.contains('delete')) {
          rowToDelete = event.target.closest('tr');
          deleteModal.style.display = 'block';
        }
          if (event.target.classList.contains('edit')) {
            rowToEdit = event.target.closest('tr');
            editModal.style.display = 'block';
            // Captura os dados do usu√°rio selecionado
            const name = rowToEdit.querySelector('.user-name')?.textContent || '';
            const email = rowToEdit.querySelector('.user-email')?.textContent || '';
            // Armazena para uso no redirecionamento
            rowToEdit.dataset.name = name;
            rowToEdit.dataset.email = email;
          }
      });

      function closeModal() {
        deleteModal.style.display = 'none';
        rowToDelete = null;
          editModal.style.display = 'none';
          rowToEdit = null;
      }

      confirmDeleteBtn.addEventListener('click', function() {
        if (rowToDelete) {
          rowToDelete.remove();
        }
        closeModal();
      });

        // L√≥gica do Modal de Confirma√ß√£o de Altera√ß√£o
        const editModal = document.getElementById('editConfirmModal');
        const confirmEditBtn = document.getElementById('confirmEditBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const closeEditConfirmSpan = document.querySelector('.close-edit-confirm');
        let rowToEdit = null;

        confirmEditBtn.addEventListener('click', function() {
            if (rowToEdit) {
              // Redireciona para a p√°gina de altera√ß√£o levando nome e email
              const name = rowToEdit.dataset.name || '';
              const email = rowToEdit.dataset.email || '';
              const params = new URLSearchParams({ name, email });
              window.location.href = `src/alteraruser.html?${params.toString()}`;
            }
            closeModal();
        });

        cancelEditBtn.addEventListener('click', closeModal);
        closeEditConfirmSpan.addEventListener('click', closeModal);

      cancelDeleteBtn.addEventListener('click', closeModal);
      closeConfirmSpan.addEventListener('click', closeModal);
      window.addEventListener('click', function(event) {
        if (event.target == deleteModal) {
          closeModal();
        }
          if (event.target == editModal) {
            closeModal();
          }
      });

      // L√≥gica do Sorteio
      const raffleButton = document.querySelector('.raffle-button');
      raffleButton.addEventListener('click', function() {
        const tbody = document.querySelector("table tbody");
        const users = tbody.querySelectorAll('tr');

        if (users.length === 0) {
          alert('N√£o h√° usu√°rios na tabela para sortear!');
          return;
        }

        // Remove o destaque de um vencedor anterior
        const previousWinner = document.querySelector('.winner');
        if (previousWinner) {
          previousWinner.classList.remove('winner');
        }

        // Sorteia um novo vencedor
        const randomIndex = Math.floor(Math.random() * users.length);
        const winnerRow = users[randomIndex];
        winnerRow.classList.add('winner');
        winnerRow.scrollIntoView({ behavior: 'smooth', block: 'center' });

        const winnerName = winnerRow.querySelector('.user-name').textContent;
        const winnerEmail = winnerRow.querySelector('.user-email').textContent;

        // Preenche e exibe o modal do vencedor
        const winnerModal = document.getElementById('raffleWinnerModal');
        document.getElementById('winnerName').textContent = winnerName;
        document.getElementById('winnerEmail').textContent = winnerEmail;
        winnerModal.style.display = 'block';

        // L√≥gica para fechar o modal do vencedor
        const closeRaffleBtn = document.getElementById('closeRaffleModalBtn');
        const closeRaffleSpan = document.querySelector('.close-raffle-winner');

        function closeRaffleModal() {
          winnerModal.style.display = 'none';
        }

        closeRaffleBtn.addEventListener('click', closeRaffleModal);
        closeRaffleSpan.addEventListener('click', closeRaffleModal);
        window.addEventListener('click', function(event) {
          if (event.target == winnerModal) {
            closeRaffleModal();
          }
        });
      });
    </script>
  </body> 
</html>
     
